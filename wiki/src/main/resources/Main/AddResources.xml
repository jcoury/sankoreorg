<?xml version="1.0" encoding="UTF-8"?>
<xwikidoc>
<web>Main</web>
<name>AddResources</name>
<language></language>
<defaultLanguage>fr</defaultLanguage>
<translation>0</translation>
<parent></parent>
<creator>XWiki.Admin</creator>
<author>XWiki.Admin</author>
<customClass></customClass>
<contentAuthor>XWiki.Admin</contentAuthor>
<creationDate>1321023697000</creationDate>
<date>1321023697000</date>
<contentUpdateDate>1321023697000</contentUpdateDate>
<version>1.1</version>
<title></title>
<template></template>
<defaultTemplate></defaultTemplate>
<validationScript></validationScript>
<comment></comment>
<minorEdit>false</minorEdit>
<syntaxId>xwiki/2.0</syntaxId>
<hidden>false</hidden><attachment>
<filename>bookmarklet.js</filename>
<filesize>3941</filesize>
<author>XWiki.FlaviusOlaru</author>
<date>1321023697000</date>
<version>1.44</version>
<comment></comment><content>ZnVuY3Rpb24gaXNFbXB0eShzdHJpbmcpIHsNCiAgcmV0dXJuICFzdHJpbmcgfHwgIS9cUy8udGVz
dChzdHJpbmcpOyAgICANCn0NCg0KZnVuY3Rpb24gcmVnaXN0ZXJ0aGlzKGlmcmFtZSkgew0KICB2
YXIgY3VycmVudF9sb2NhdGlvbiA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmOw0KICBjdXJyZW50X2xv
Y2F0aW9uID0gY3VycmVudF9sb2NhdGlvbi5zcGxpdCgnIz0nKVswXTsNCiAgY29uc29sZS5sb2co
InJlZ2lzdGVydGhpczogIiArIGN1cnJlbnRfbG9jYXRpb24pOw0KICBpZnJhbWUuY29udGVudFdp
bmRvdy5sb2NhdGlvbiA9IGlmcmFtZS5zcmMgKyAnIz0nICsgZXNjYXBlKGN1cnJlbnRfbG9jYXRp
b24pOyAgDQp9DQoNCmZ1bmN0aW9uIHJlc2l6ZXRoaXMoKSB7DQogIHZhciBpZnJhbWUgPSBkb2N1
bWVudC5nZXRFbGVtZW50QnlJZCgiYm9va21hcmtsZXQtaWZyYW1lIik7DQogIHZhciBoYXNoID0g
d2luZG93LmxvY2F0aW9uLmhhc2guc3BsaXQoJyM9Jyk7DQogIGlmIChoYXNoLmxlbmd0aCA+IDEp
IHsNCiAgICB2YXIgaGFzaGZyYWdtZW50ID0gaGFzaFsxXTsNCiAgICBpZiAoaGFzaGZyYWdtZW50
KSB7DQogICAgICB2YXIgcGFpcnMgPSBoYXNoZnJhZ21lbnQuc3BsaXQoJyYnKTsNCiAgICAgIHZh
ciBoZWlnaHQgPSAiIjsNCiAgICAgIHZhciB3aWR0aCA9ICIiOw0KICAgICAgalF1ZXJ5LmVhY2go
cGFpcnMsIGZ1bmN0aW9uKGksIHBhaXIpIHsNCiAgICAgICAgdmFyIHBhaXJzcGxpdCA9IHBhaXIu
c3BsaXQoJz0nKTsNCiAgICAgICAgaWYgKHBhaXJzcGxpdFswXSA9PSAiaGVpZ2h0IikgaGVpZ2h0
ID0gcGFpcnNwbGl0WzFdOw0KICAgICAgICBpZiAocGFpcnNwbGl0WzBdID09ICJ3aWR0aCIpIHdp
ZHRoID0gcGFpcnNwbGl0WzFdOw0KICAgICAgfSk7DQogICAgICBpZiAoaGVpZ2h0ICE9ICIiIHx8
IHdpZHRoICE9ICIiKSB7DQogICAgICAgIGlmIChoZWlnaHQgIT0gIiIpIHsNCiAgICAgICAgICBp
ZnJhbWUuc3R5bGUuaGVpZ2h0ID0gaGVpZ2h0ICsgInB4IjsNCiAgICAgICAgfQ0KICAgICAgICBp
ZiAod2lkdGggIT0gIiIpIHsNCiAgICAgICAgICBpZnJhbWUuc3R5bGUud2lkdGggPSB3aWR0aCAr
ICJweCI7DQogICAgICAgIH0NCiAgICAgICAgd2luZG93LmxvY2F0aW9uLmhhc2ggPSBoYXNoWzBd
Ow0KICAgICAgICBjb25zb2xlLmxvZygicmVzaXpldGhpczogaGVpZ2h0PSIgKyBoZWlnaHQpOw0K
ICAgICAgICBjb25zb2xlLmxvZygicmVzaXpldGhpczogd2lkdGg9IiArIHdpZHRoKTsNCiAgICAg
IH0NCiAgICB9DQogIH0gIA0KfQ0KDQppZiAodHlwZW9mIGpRdWVyeSA9PSAndW5kZWZpbmVkJykg
ew0KICAgIHZhciBqUSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOw0KICAgIGpR
LnR5cGUgPSAndGV4dC9qYXZhc2NyaXB0JzsNCiAgICBqUS5vbmxvYWQgPSBydW50aGlzOw0KICAg
IGpRLnNyYyA9ICdodHRwOi8vYWpheC5nb29nbGVhcGlzLmNvbS9hamF4L2xpYnMvanF1ZXJ5LzEv
anF1ZXJ5Lm1pbi5qcyc7DQogICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChqUSk7DQp9IGVs
c2Ugew0KICAgIHJ1bnRoaXMoKTsNCn0NCg0KZnVuY3Rpb24gcnVudGhpcygpIHsNCiAgICB2YXIg
dXJsID0gbG9jYXRpb24uaHJlZjsNCiAgICB2YXIgdGl0bGUgPSAoKGRvY3VtZW50LnRpdGxlKSA/
IGRvY3VtZW50LnRpdGxlIDogZG9jdW1lbnQubG9jYXRpb24uaG9zdCk7DQogICAgdmFyIGlmcmFt
ZVNyYyA9ICdodHRwOi8vc2Fua29yZS5kZXZ4d2lraS5jb20veHdpa2kvYmluL3ZpZXcvTWFpbi9B
ZGRSZXNvdXJjZXM/eHBhZ2U9Ym9va21hcmtsZXQmdXJsPScrZXNjYXBlKHVybCkrJyZ0aXRsZT0n
K2VzY2FwZSh0aXRsZSk7ICANCiAgICBpZnJhbWVTcmMgPSBpZnJhbWVTcmMgKyAnIz0nICsgZXNj
YXBlKGxvY2F0aW9uLmhyZWYpOyAgDQogICAgdmFyIGVycm9yID0gZmFsc2U7DQogICAgDQogICAg
aWYgKCQoIiNmcmFtZSIpLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICBpZiAodXJsID09PSAiIikg
ew0KICAgICAgICAgICAgYWxlcnQoIlVSTCBpbnZhbGlkZSIpOw0KICAgICAgICAgICAgZXJyb3Ig
PSB0cnVlOw0KICAgICAgICB9DQogICAgICAgIGlmICghZXJyb3IpIHsNCiAgICAgICAgICAgICQo
ImJvZHkiKS5hcHBlbmQoIlwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0nYm9v
a21hcmtsZXQnPlwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0nZnJhbWVf
dmVpbCcgc3R5bGU9Jyc+XA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cD5Mb2Fk
aW5nLi4uPC9wPlwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XA0KICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICA8aWZyYW1lIGlkPSdib29rbWFya2xldC1pZnJhbWUnIHNy
Yz0nIiArIGlmcmFtZVNyYyArICInIG9ubG9hZD1cImNvbnNvbGUubG9nKCdpZnJhbWUgbG9hZGVk
Jyk7JCgnI2Jvb2ttYXJrbGV0IGlmcmFtZScpLmZhZGVJbigzMDApO1wiPkVuYWJsZSBpRnJhbWVz
LjwvaWZyYW1lPlwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHN0eWxlIHR5cGU9J3Rl
eHQvY3NzJz5cDQogICAgICAgICAgICAgICAgICAgICAjYm9va21hcmtsZXQgeyBkaXNwbGF5Om5v
bmU7IHBvc2l0aW9uOiBhYnNvbHV0ZTsgd2lkdGg6IDEwMCU7IGhlaWdodDogMTAwJTsgdG9wOiAw
OyBsZWZ0OiAwOyBiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDI1NSwyNTUsMjU1LC43KTsgY3Vyc29y
OiBwb2ludGVyOyB6LWluZGV4OiA5MDA7IH1cDQogICAgICAgICAgICAgICAgICAgICNmcmFtZV92
ZWlsIHAgeyBjb2xvcjogIzY2NjsgZm9udDogYm9sZCAyMHB4LzIwcHggSGVsdmV0aWNhLCBzYW5z
LXNlcmlmOyBwb3NpdGlvbjogYWJzb2x1dGU7IHRvcDogNTAlOyBsZWZ0OiA1MCU7IHdpZHRoOiAx
MGVtOyBtYXJnaW46IC0xMHB4IGF1dG8gMCAtNWVtOyB0ZXh0LWFsaWduOiBjZW50ZXI7IH1cDQog
ICAgICAgICAgICAgICAgICAgICNib29rbWFya2xldCBpZnJhbWUgeyBkaXNwbGF5OiBub25lOyBw
b3NpdGlvbjogYWJzb2x1dGU7IHRvcDogNSU7IGxlZnQ6IDUwJTsgIHdpZHRoOiA3NjBweDsgaGVp
Z2h0OiA5MCU7IHotaW5kZXg6IDk5OTsgYm9yZGVyOiAxMHB4IHNvbGlkIHJnYmEoMCwwLDAsLjUp
OyBtYXJnaW46MCBhdXRvO21hcmdpbi1sZWZ0Oi0zODBweDsgfVwNCiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgPC9zdHlsZT5cDQogICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+Iik7
DQogICAgICAgICAgICAkKCIjYm9va21hcmtsZXQiKS5mYWRlSW4oMTAwKTsNCiAgICAgICAgICAg
IHdpbmRvdy5zZXRJbnRlcnZhbCgicmVzaXpldGhpcygpIiw1MDApOw0KICAgICAgICB9DQogICAg
fSBlbHNlIHsNCiAgICAgICAgJCgiI2Jvb2ttYXJrbGV0IikuZmFkZU91dCgzMDApOw0KICAgICAg
ICBzZXRUaW1lb3V0KCIkKCcjYm9va21hcmtsZXQnKS5yZW1vdmUoKSIsIDQwMCk7DQogICAgfQ0K
ICAgICQoIiNib29rbWFya2xldCIpLmNsaWNrKGZ1bmN0aW9uKGV2ZW50KSB7DQogICAgICAgICQo
IiNib29rbWFya2xldCIpLmZhZGVPdXQoMzAwKTsNCiAgICAgICAgc2V0VGltZW91dCgiJCgnI2Jv
b2ttYXJrbGV0JykucmVtb3ZlKCkiLCA0MDApOw0KICAgIH0pOw0KfQ0KDQoNCg0KZnVuY3Rpb24g
Z2V0U2VsVGV4dCgpIHsNCiAgICB2YXIgcyA9ICcnOw0KICAgIGlmICh3aW5kb3cuZ2V0U2VsZWN0
aW9uKSB7DQogICAgICAgIHMgPSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCk7DQogICAgfSBlbHNlIGlm
IChkb2N1bWVudC5nZXRTZWxlY3Rpb24pIHsNCiAgICAgICAgcyA9IGRvY3VtZW50LmdldFNlbGVj
dGlvbigpOw0KICAgIH0gZWxzZSBpZiAoZG9jdW1lbnQuc2VsZWN0aW9uKSB7DQogICAgICAgIHMg
PSBkb2N1bWVudC5zZWxlY3Rpb24uY3JlYXRlUmFuZ2UoKS50ZXh0Ow0KICAgIH0NCiAgICByZXR1
cm4gczsNCn0=
</content></attachment>
<content>{{velocity}}
#if($context.user=="XWiki.XWikiGuest")
#set($qs = "")
#set($targeturl = $util.encodeURI($request.url))
#set($targettitle = $util.encodeURI($request.title))
#set($rurl = $util.encodeURI($doc.getURL('view', "url=$!{targeturl}&amp;title=$!{targettitle}")))
#set($qs = "xredirect=${rurl}")
$response.sendRedirect($xwiki.getURL("XWiki.XWikiLogin", "login", $qs))
#else
#if($request.url)
{{html clean="false"}}
&lt;script type="text/javascript"&gt;
document.observe("dom:loaded", function() {
  Curriki.module.addpath.startPath('Bookmarklet', { 'linkUrl' : "$request.url" });
 //Curriki.module.addpath.initAndStart(function(){
 //  Curriki.module.addpath.SourceSelected('url', { 'link' : "$request.url" });
 //}, {})
#if($request.title)
 //setTimeout('checkTitleField()', 1000);
#end
});

#if($request.title)
/*
function checkTitleField() {
  if (typeof(document.forms["MetadataDialogueForm"])=="undefined") {
   setTimeout('checkTitleField()', 1000);
  } else {
    document.forms["MetadataDialogueForm"].title.value= '${escapetool.javascript($request.title)}';
    // window.alert('Hello!');   
  }
}
*/
#end
&lt;/script&gt;
{{/html}}
#else
No URL was provided
#end
#end
{{/velocity}}</content></xwikidoc>