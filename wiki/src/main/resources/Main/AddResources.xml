<?xml version="1.0" encoding="UTF-8"?>
<xwikidoc>
<web>Main</web>
<name>AddResources</name>
<language></language>
<defaultLanguage>fr</defaultLanguage>
<translation>0</translation>
<parent></parent>
<creator>XWiki.Admin</creator>
<author>XWiki.Admin</author>
<customClass></customClass>
<contentAuthor>XWiki.Admin</contentAuthor>
<creationDate>1322586317000</creationDate>
<date>1322586317000</date>
<contentUpdateDate>1322586317000</contentUpdateDate>
<version>1.1</version>
<title></title>
<template></template>
<defaultTemplate></defaultTemplate>
<validationScript></validationScript>
<comment></comment>
<minorEdit>false</minorEdit>
<syntaxId>xwiki/2.0</syntaxId>
<hidden>false</hidden><attachment>
<filename>close.png</filename>
<filesize>1921</filesize>
<author>XWiki.FlaviusOlaru</author>
<date>1322046775000</date>
<version>1.3</version>
<comment></comment><content>iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJ
bWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdp
bj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6
eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYxIDY0LjE0
MDk0OSwgMjAxMC8xMi8wNy0xMDo1NzowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJo
dHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlw
dGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAv
IiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RS
ZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpD
cmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNS4xIFdpbmRvd3MiIHhtcE1NOkluc3RhbmNl
SUQ9InhtcC5paWQ6MjMzQ0MxRjExNUM3MTFFMUJBRUQ4RUVCMjhCNzUzOUYiIHhtcE1NOkRvY3Vt
ZW50SUQ9InhtcC5kaWQ6MjMzQ0MxRjIxNUM3MTFFMUJBRUQ4RUVCMjhCNzUzOUYiPiA8eG1wTU06
RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDoyMzNDQzFFRjE1QzcxMUUxQkFF
RDhFRUIyOEI3NTM5RiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDoyMzNDQzFGMDE1QzcxMUUx
QkFFRDhFRUIyOEI3NTM5RiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1w
bWV0YT4gPD94cGFja2V0IGVuZD0iciI/PrCctNUAAAP1SURBVHjarFddSJNhFH72U5RC5l9Ef1MQ
bbqwLAqioqsu6mKFEl0UJYlXQRRJUWkRJBX0Q3QVXRQZREm1C+miG6EUCkMvpmZM1DL70VVKTlG3
dc4627657/u2b+3Aw9j7nr/3fOec97ymmpoaGKQ8goOwQsA0InATxowosxowepDgJGwnWDT4/ITX
BBehKRlnzAn2MwhnCR7CTcJOHeOQvZ3C6xHZjFQd2EDoJlwmZME4ZYlst+gy5ECVhLIA/08Foqsq
WQeY8QkhE+mjTNFZlSgJOVQPCCbNpJicxOqhIeR4vVjs84XWpjIy8DM3F59tNvgyNf02ie5+Qqea
A5wsz/WSZnN7O0p6eqC331daindbt+olNdsoJYS8t1RUVIQ3TxEq1aSKe3uxrbUVK4eHE9fr6CgK
+/sRNJvhzc9XY1lKmCS8UeZALuG0GndRXx82vX2LJePjSX9w5mUZltWg02Iz4sAhrVIrodNb5uYM
Zx3LsKxOiR5SOuBU41r//j1yxqLNLHvXLmzs6sLqurr4U2/ZAkdLC5ZXV0fWWJZ1aJAz7ACHYpsa
h93tjvm/8vhxZJaXo/DaNdguXIgeZ8cOrHv1Cjm7d6Po9m2YLBZNHQpim7lWuVji7oQVlHDW2dmY
tZE7d5BDUYDVCtvFiwhMT+NPRwfKXC6Ypfy+NzUh6PdH65x0sK6RVavUWoDDrLjRYlP116+4tZ8v
X+LDkSN05fwzUHjlChy0FjF+/z48x44lpSt8Tk0HuOGo0Y9Hj/CxtjbaXRYsCP1+u3cPH48ejTl9
Il1hB1QpaNJshpijLoh5hiba2hAMBAxXi1kGiTji9qpG+ZWVsD99SnUWeysXUwSWHTigKqPTnkc0
HfidnR3f5fbuhf3x40jYh69fx+C5c1L4Fqx9+BB5TmdSusIOWGWM8s8fNDhr58iQshLWnD8fqgCm
z42NGBDj5kWLsKa+PrTHJTrmckU/F+lQqYDw9OTmCHjDfXk+9TocMf+/3r2LmS9fMHDmTMQ402BD
Az5duoTA1BTGnj3T1aEgtuk1yVB6gnBDjWvPixcx3VA3oRYuRGBmJlq2eXlooc+mQSd5dAtXAQ+Q
E2pcfXY7/NbkZlelcZZhWQ2aEJuRu2CUcFWN01NSgg7q8xNZyY+FzMsyLKtBV8UmTIp3AdcdTxu2
VAeSUMT0BxKmIeVAoowtL+yT5FBtAqzYTZdRiiOZ0oZPaybkWe2wDJAmrabCp0yBgqK7M9FU3EzY
L2NTumhSdDYn+y5olifYYBqMD4quZqMvIw5VGYE7zngKhsdFtmx+2I28DTlZGnk2lWbVKi0UOo/T
VuEtEllfOl7H3ApvCdL6PP8rwAA6bEyW6TLlPAAAAABJRU5ErkJggg==
</content></attachment>
<object>
<class>
<name>XWiki.JavaScriptExtension</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<cache>
<cache>0</cache>
<disabled>0</disabled>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>cache</name>
<number>5</number>
<prettyName>Caching policy</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>1</size>
<unmodifiable>0</unmodifiable>
<values>long|short|default|forbid</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</cache>
<code>
<disabled>0</disabled>
<name>code</name>
<number>2</number>
<prettyName>Code</prettyName>
<rows>20</rows>
<size>50</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</code>
<name>
<disabled>0</disabled>
<name>name</name>
<number>1</number>
<prettyName>Name</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</name>
<parse>
<disabled>0</disabled>
<displayFormType>select</displayFormType>
<displayType>yesno</displayType>
<name>parse</name>
<number>4</number>
<prettyName>Parse content</prettyName>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
</parse>
<use>
<cache>0</cache>
<disabled>0</disabled>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>use</name>
<number>3</number>
<prettyName>Use this extension</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>1</size>
<unmodifiable>0</unmodifiable>
<values>currentPage=Always on this page|onDemand=On demand|always=Always on this wiki</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</use>
</class>
<name>Main.AddResources</name>
<number>0</number>
<className>XWiki.JavaScriptExtension</className>
<guid>4336c938-1820-413b-885e-aa7eb3a575f0</guid>
<property>
<cache>long</cache>
</property>
<property>
<code>if (typeof console == 'undefined') {
  console = {};
  console.log = function () {};
}
function resizethis() {
  var iframe = document.getElementById('bookmarklet-iframe');
  var inner = document.getElementById('bookmarklet-inner');
  var hash = window.location.hash.split('#=');
  if (hash.length &gt; 1) {
    var hashfragment = hash[1];
    if (hashfragment) {
      var pairs = hashfragment.split('&amp;');
      var height = "";
      var width = "";
      jQuery.each(pairs, function(i, pair) {
        var pairsplit = pair.split('=');
        if (pairsplit[0] == "height") height = pairsplit[1];
        if (pairsplit[0] == "width") width = pairsplit[1];
      });
      if (height != "" || width != "") {
        jQuery('#bookmarklet-loading').hide();
        jQuery(iframe).height(height);
        jQuery(iframe).width(width);
        jQuery(iframe).css('marginTop', '0');
        jQuery(inner).height(height);
        jQuery(inner).width(width);
        window.location.hash = hash[0];
        console.log("resizethis: height=" + height);
        console.log("resizethis: width=" + width);
      }
    }
  }  
}
function runthis() {
  //jQuery(window).unload(function(){alert("unload");});   
  
  var url = window.location.href;
  var title = ((document.title) ? document.title : document.location.host);
  var iframeSrc = 'http://sankore.devxwiki.com/xwiki/bin/view/Main/AddResources?xpage=bookmarklet&amp;url='+escape(url)+'&amp;title='+escape(title);
  var error = false;
    
  if (jQuery("#frame").length === 0) {
    if (url === "") {
      alert("URL invalide");
      error = true;
    }
    if (!error) {
      jQuery("body").append("&lt;div id='bookmarklet' style='display:none;'&gt;&lt;div id='bookmarklet-overlay' style='position: fixed; width: 100%; height: 100%; top: 0; left: 0; filter: alpha(opacity=30); filter:progid:DXImageTransform.Microsoft.Alpha(opacity=30); -moz-opacity: .30; -khtml-opacity: 0.3; opacity: 0.3; background-color:#000000; cursor: pointer; z-index: 997;'&gt;&lt;/div&gt;&lt;div  style='color: #666; font: bold 20px/20px Helvetica, sans-serif; position: absolute; top: 10%; left: 50%; width: 10em; margin: -10px auto 0 -5em; text-align: center;'&gt;&lt;p&gt;Loading...&lt;/p&gt;&lt;/div&gt;&lt;div id='bookmarklet-inner' style='display: block; position: absolute; top: 10%; left: 50%;  width: 760px; z-index: 998; border-color: #666666; border-style: solid; border-width:10px; margin:0 auto;margin-left:-380px;height:100px;'&gt;&lt;div id='bookmarklet-close' style='background: url(http://sankore.devxwiki.com/xwiki/bin/download/Main/AddResources/close.png); position: absolute; width: 32px; height: 32px; top: -28px; right: -28px; cursor: pointer; z-index:999;'&gt;&lt;/div&gt;&lt;div id='bookmarklet-loading' style='position:absolute;top:0;left:0;height:100px;background: url(http://sankore.devxwiki.com/xwiki/resources/icons/xwiki/ajax-loader-large.gif) no-repeat scroll center center #FFF;width:760px;'&gt;&lt;/div&gt;&lt;iframe id='bookmarklet-iframe' style='width: 760px; height:1000px;margin-top:5000px;' src='" + iframeSrc + "' onload=\"\" frameBorder='0'&gt;Enable iFrames.&lt;/iframe&gt;&lt;/div&gt;&lt;/div&gt;");                    
      window.setInterval("resizethis()",400);            
      jQuery('#bookmarklet').fadeIn(500);
    }
  } else {
    jQuery("#bookmarklet").fadeOut(300);
    setTimeout("jQuery('#bookmarklet').remove()", 400);
  }
  jQuery("#bookmarklet-close").click(function(event) {
    jQuery("#bookmarklet").fadeOut(300);
    setTimeout("jQuery('#bookmarklet').remove()", 400);
  });
  jQuery("#bookmarklet").click(function(event) {
    jQuery("#bookmarklet").fadeOut(300);
    setTimeout("jQuery('#bookmarklet').remove()", 400);
  });
}
if (typeof jQuery == 'undefined') {
  var jQ = document.createElement('script');
  jQ.type = 'text/javascript';
  // IE8 doesn't run onload
  //jQ.onload = runthis;
  jQ.src = 'http://sankore.devxwiki.com/xwiki/resources/js/jquery/jquery.js';
  document.body.appendChild(jQ);
  // IE8 fix for onload
  setTimeout("runthis()", 1000);
} else {
  runthis();
}</code>
</property>
<property>
<name>Bookmarklet JSX</name>
</property>
<property>
<parse>0</parse>
</property>
<property>
<use>onDemand</use>
</property>
</object>
<content>{{velocity}}
#if($context.user=="XWiki.XWikiGuest")
  #set($qs = "$!{request.queryString}")
  #if(!$request.getParameter('xredirect'))
    #set($qs = $escapetool.url($doc.getURL('view', "$!{qs}")))
  #end
  $response.sendRedirect($xwiki.getURL('XWiki.XWikiLogin', 'login', "xredirect=${qs}"))
#else
  #if($request.url)
{{html clean="false"}}
&lt;script type="text/javascript"&gt;
document.observe("dom:loaded", function() {
  Curriki.module.addpath.startPath('Bookmarklet', { 'linkUrl' : "$request.url" });
});
&lt;/script&gt;
{{/html}}
#else
No URL was provided
#end
#end
{{/velocity}}</content></xwikidoc>