<?xml version="1.0" encoding="UTF-8"?>
<xwikidoc>
<web>Main</web>
<name>AddResources</name>
<language></language>
<defaultLanguage>fr</defaultLanguage>
<translation>0</translation>
<parent></parent>
<creator>XWiki.Admin</creator>
<author>XWiki.Admin</author>
<customClass></customClass>
<contentAuthor>XWiki.Admin</contentAuthor>
<creationDate>1320688595000</creationDate>
<date>1320688595000</date>
<contentUpdateDate>1320688595000</contentUpdateDate>
<version>1.1</version>
<title></title>
<template></template>
<defaultTemplate></defaultTemplate>
<validationScript></validationScript>
<comment></comment>
<minorEdit>false</minorEdit>
<syntaxId>xwiki/2.0</syntaxId>
<hidden>false</hidden><attachment>
<filename>bookmarklet.js</filename>
<filesize>2459</filesize>
<author>XWiki.FlaviusOlaru</author>
<date>1320688595000</date>
<version>1.1</version>
<comment></comment><content>aWYgKHR5cGVvZiBqUXVlcnkgPT0gJ3VuZGVmaW5lZCcpIHsNCiAgICB2YXIgalEgPSBkb2N1bWVu
dC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsNCiAgICBqUS50eXBlID0gJ3RleHQvamF2YXNjcmlw
dCc7DQogICAgalEub25sb2FkID0gcnVudGhpczsNCiAgICBqUS5zcmMgPSAnaHR0cDovL2FqYXgu
Z29vZ2xlYXBpcy5jb20vYWpheC9saWJzL2pxdWVyeS8xL2pxdWVyeS5taW4uanMnOw0KICAgIGRv
Y3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoalEpOw0KfSBlbHNlIHsNCiAgICBydW50aGlzKCk7DQp9
DQoNCmZ1bmN0aW9uIHJ1bnRoaXMoKSB7DQogICAgdmFyIGlmcmFtZVNyYyA9ICdodHRwOi8vc2Fu
a29yZS5kZXZ4d2lraS5jb20veHdpa2kvYmluL3ZpZXcvTWFpbi9BZGRSZXNvdXJjZXM/eHBhZ2U9
Ym9va21hcmtsZXQmdXJsPSc7DQogICAgdmFyIHVybCA9IGxvY2F0aW9uLmhyZWY7DQogICAgdmFy
IHRpdGxlID0gKChkb2N1bWVudC50aXRsZSkgPyBkb2N1bWVudC50aXRsZSA6IGRvY3VtZW50Lmxv
Y2F0aW9uLmhvc3QpOw0KICAgIHZhciBlcnJvciA9IGZhbHNlOw0KICAgIA0KICAgIGlmICgkKCIj
ZnJhbWUiKS5sZW5ndGggPT09IDApIHsNCiAgICAgICAgaWYgKHVybCA9PT0gIiIpIHsNCiAgICAg
ICAgICAgIGFsZXJ0KCJVUkwgaW52YWxpZGUiKTsNCiAgICAgICAgICAgIGVycm9yID0gdHJ1ZTsN
CiAgICAgICAgfQ0KICAgICAgICBpZiAoIWVycm9yKSB7DQogICAgICAgICAgICAkKCJib2R5Iiku
YXBwZW5kKCJcDQogICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9J2Jvb2ttYXJrbGV0
Jz5cDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9J2ZyYW1lX3ZlaWwnIHN0
eWxlPScnPlwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHA+TG9hZGluZy4uLjwv
cD5cDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlwNCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgPGlmcmFtZSBpZD0nYm9va21hcmtsZXQtaWZyYW1lJyBzcmM9JyIgKyBp
ZnJhbWVTcmMgKyB1cmwgKyAiJyBvbmxvYWQ9XCIkKCcjYm9va21hcmtsZXQgaWZyYW1lJykuZmFk
ZUluKDMwMCk7XCI+RW5hYmxlIGlGcmFtZXMuPC9pZnJhbWU+XA0KICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICA8c3R5bGUgdHlwZT0ndGV4dC9jc3MnPlwNCiAgICAgICAgICAgICAgICAgICAg
ICNib29rbWFya2xldCB7IGRpc3BsYXk6bm9uZTsgcG9zaXRpb246IGZpeGVkOyB3aWR0aDogMTAw
JTsgaGVpZ2h0OiAxMDAlOyB0b3A6IDA7IGxlZnQ6IDA7IGJhY2tncm91bmQtY29sb3I6IHJnYmEo
MjU1LDI1NSwyNTUsLjcpOyBjdXJzb3I6IHBvaW50ZXI7IHotaW5kZXg6IDkwMDsgfVwNCiAgICAg
ICAgICAgICAgICAgICAgI2ZyYW1lX3ZlaWwgcCB7IGNvbG9yOiAjNjY2OyBmb250OiBib2xkIDIw
cHgvMjBweCBIZWx2ZXRpY2EsIHNhbnMtc2VyaWY7IHBvc2l0aW9uOiBhYnNvbHV0ZTsgdG9wOiA1
MCU7IGxlZnQ6IDUwJTsgd2lkdGg6IDEwZW07IG1hcmdpbjogLTEwcHggYXV0byAwIC01ZW07IHRl
eHQtYWxpZ246IGNlbnRlcjsgfVwNCiAgICAgICAgICAgICAgICAgICAgI2Jvb2ttYXJrbGV0IGlm
cmFtZSB7IGRpc3BsYXk6IG5vbmU7IHBvc2l0aW9uOiBmaXhlZDsgdG9wOiAxMCU7IGxlZnQ6IDEw
JTsgd2lkdGg6IDc2MHB4OyBoZWlnaHQ6IDkwJTsgei1pbmRleDogOTk5OyBib3JkZXI6IDEwcHgg
c29saWQgcmdiYSgwLDAsMCwuNSk7IG1hcmdpbjowIGF1dG8gfVwNCiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgPC9zdHlsZT5cDQogICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+Iik7
DQogICAgICAgICAgICAkKCIjYm9va21hcmtsZXQiKS5mYWRlSW4oMTAwKTsNCiAgICAgICAgfQ0K
ICAgIH0gZWxzZSB7DQogICAgICAgICQoIiNib29rbWFya2xldCIpLmZhZGVPdXQoMzAwKTsNCiAg
ICAgICAgc2V0VGltZW91dCgiJCgnI2Jvb2ttYXJrbGV0JykucmVtb3ZlKCkiLCA0MDApOw0KICAg
IH0NCiAgICAkKCIjYm9va21hcmtsZXQiKS5jbGljayhmdW5jdGlvbihldmVudCkgew0KICAgICAg
ICAkKCIjYm9va21hcmtsZXQiKS5mYWRlT3V0KDMwMCk7DQogICAgICAgIHNldFRpbWVvdXQoIiQo
JyNib29rbWFya2xldCcpLnJlbW92ZSgpIiwgNDAwKTsNCiAgICB9KTsNCn0NCg0KZnVuY3Rpb24g
Z2V0U2VsVGV4dCgpIHsNCiAgICB2YXIgcyA9ICcnOw0KICAgIGlmICh3aW5kb3cuZ2V0U2VsZWN0
aW9uKSB7DQogICAgICAgIHMgPSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCk7DQogICAgfSBlbHNlIGlm
IChkb2N1bWVudC5nZXRTZWxlY3Rpb24pIHsNCiAgICAgICAgcyA9IGRvY3VtZW50LmdldFNlbGVj
dGlvbigpOw0KICAgIH0gZWxzZSBpZiAoZG9jdW1lbnQuc2VsZWN0aW9uKSB7DQogICAgICAgIHMg
PSBkb2N1bWVudC5zZWxlY3Rpb24uY3JlYXRlUmFuZ2UoKS50ZXh0Ow0KICAgIH0NCiAgICByZXR1
cm4gczsNCn0=
</content></attachment>
<content>{{velocity}}
#if($context.user=="XWiki.XWikiGuest")
#set($qs = "")
#set($targeturl = $util.encodeURI($request.url))
#set($targettitle = $util.encodeURI($request.title))
#set($rurl = $util.encodeURI($doc.getURL('view', "url=$!{targeturl}&amp;title=$!{targettitle}")))
#set($qs = "xredirect=${rurl}")
$response.sendRedirect($xwiki.getURL("XWiki.XWikiLogin", "login", $qs))
#else
#if($request.url)
{{html clean="false"}}
&lt;script type="text/javascript"&gt;
document.observe("dom:loaded", function() {
  Curriki.module.addpath.startPath('Bookmarklet', { 'linkUrl' : "$request.url" });
 //Curriki.module.addpath.initAndStart(function(){
 //  Curriki.module.addpath.SourceSelected('url', { 'link' : "$request.url" });
 //}, {})
#if($request.title)
 setTimeout('checkTitleField()', 1000);
#end
});

#if($request.title)
function checkTitleField() {
  if (typeof(document.forms["MetadataDialogueForm"])=="undefined") {
   setTimeout('checkTitleField()', 1000);
  } else {
    document.forms["MetadataDialogueForm"].title.value= '${escapetool.javascript($request.title)}';
    // window.alert('Hello!');   
  }
}
#end
&lt;/script&gt;
{{/html}}
#else
No URL was provided
#end
#end
{{/velocity}}</content></xwikidoc>